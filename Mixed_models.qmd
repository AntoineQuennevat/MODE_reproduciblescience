---
title: "Mixed models in ecology"
bibliography: references.bib
execute: 
  freeze: auto
output: 
  html_document:
   toc: true
   toc_float: true
---

## Introduction : Louis

## Model: création du model : Abdou

The linear mixed model can be formulated as follows:

$$
Y_{ij} = X_{ij}\beta + Z_{ij}b_i + \varepsilon_{ij}
$$

where $$Y_{ij}$$ is the response variable for observation $$i$$ in group $$j$$, $$X_{ij}$$ is the matrix of fixed predictors for observation $$i$$ in group $$j$$, $$\beta$$ is the vector of fixed coefficients, $$Z_{ij}$$ is the matrix of random predictors for observation $$i$$ in group $$j$$, $$b_i$$ is the vector of random effects for observation $$i$$ and $$\varepsilon_{ij}$$ is the error term for observation $$i$$ in group $$j$$.


A mixed effects model incorporates random effects ($$b_i$$), or a combination of both random and fixed effects ($$\beta$$), whereas a standard linear model includes only fixed effects. The distinction between these two lies in the nature of the effects related to the treatment under study.

When it is evident that the researcher intends to compare particular, predefined levels of a treatment, those levels are considered fixed effects. Conversely, when the levels of the treatment are drawn from a larger population of possible levels, the treatment is treated as a random effect.

In addition, random effects are included in a model when there is a correlation or dependence among the observations that cannot be ignored.

**RANDOM VARIABLE** = « something that could not be known before sampling/measurement/observation".


In matrix form, the mixed model is written as:

$$
Y \sim \mathcal{N}(X\theta, \Sigma)
$$ 
where:

$$Y$$ is the response vector of the observations, $$X\theta$$ is the expectation of the response vector $$Y$$ and $$\Sigma$$ is the variance matrix.









## Calcule matriciel : Antoine

$$
  M_{2\times2} = \left( {\begin{array}{cc}
    A & B \\
    C & D \\
  \end{array} } \right)
$$
Il est possible de rencontrer des modèles linéaires (mixtes) sous forme matricielle, de part la concision de la forme. Il est donc naturel de présenter cette forme dans le cadre des modèles mixtes.


Pour rappel, un modèle linéaire, de type regression linéaire, avec $$p$$ variables explicatives s'écrivant sous la forme $$Y_i = \beta_0 + \beta_1X_i^{(1)} + \ldots + \beta_pX_i^{p} + \varepsilon_i$$, avec $$\varepsilon_i \sim \mathcal{N}(0,\sigma^2)$$, peut s'écrire sous forme matriciel $$Y=X\theta+\mathrm{E}$$ où $$Y=\begin{pmatrix}
Y_1\\
\vdots\\
Y_n\\
\end{pmatrix}$$, $$X=\begin{pmatrix}
1&X_1^{(1)} & \ldots & X_1^{(p)}\\
\vdots & \vdots & \ldots & \vdots \\
1 & X_n^{(1)} & \ldots & X_n^{(p)}
\end{pmatrix}$$, $$\theta=\begin{pmatrix}
\beta_0\\
\vdots\\
\beta_p\\
\end{pmatrix}$$, et $$\mathrm{E}=\begin{pmatrix}
\varepsilon_0\\
\vdots\\
\varepsilon_n\\
\end{pmatrix}$$


## Structure de dependance : Odin

### Cas des Mesures répétées

On considère cette fois une expérience visant à évaluer l'effet d'un régime sur la prise de poids d'un animal au cours du temps. Plusieurs animaux (indicés par $j$) reçoivent chaque régime (noté $i$) et un animal ne reçoit qu'un régime au cours de l'expérience. On mesure le poids, noté $Y_{ij}$, de chaque animal au bout de t semaines ($t = 1, . . . , T$). On parle donc de mesures répétées, au cours du temps sur un même individu. De telles mesures sont aussi fréquemment appelées données *longitudinales*. Pour analyser ces résultats, on veut tenir compte du fait que les mesures faites au cours du temps sur un même animal ne sont pas indépendantes. A cette fin, on pourrait utiliser le modèle :

$$E(Y_{ijt}) = µ + α_i + γ_t + (αγ)_{it}$$

avec

$$Cov(Y_{ijt}, Y_{i'j't'}) = \left\{ 
  \begin{array}{ll}
  σ^2ρ \ \ si \ \ (i, j) = (i_0, j_0) \\
     0 \ sinon \
   \end{array}
  \right.$$

Dans ce modèle, la covariance entre deux mesures faites aux temps t et t' sur un même modèle est constante, quel que soit l'intervalle de temps qui sépare les deux mesures.


**Modèle** On propose ici un modèle qui prend en compte l'aspect cinétique de l'expérience et prévoit que la dépendance entre deux mesures dépend de l'intervalle de temps qui les sépare. Une telle dépendance n'admet pas de représentation simple sous la forme d'un eet aléatoire. On suppose donc que les poids sont gaussiens d'espérances
respectives.

$$ E(Y_{ijt}) = µ + α_i + γ_t + (αγ)_{it} $$ 
**Structure de dépendance** On suppose de plus que toutes les mesures ont la même
variance

$$ V(Y_{ijt} =  σ^2) $$
et que la covariance entre elles vaut

$$Cov(Y_{ijt}, Y_{i'j't'}) = \left\{ 
  \begin{array}{ll}
  σ^2ρ^{|t-t'|} \ \ si \ \ (i, j) = (i', j') \\
     0 \ sinon \
   \end{array}
  \right.$$
Cette structure suppose que les mesures faites sur des animaux diérents sont indépendantes. On suppose de plus que |ρ| < 1, ce qui implique que celles faites sur un même animal sont d'autant moins corrélées que l'intervalle de temps est grand. Cette forme de covariance correspond à un processus auto-régressif d'ordre 1, généralement noté AR(1).
Ce modèle comporte deux paramètres de variance (aussi appelés composantes de la variance) : la corrélation temporelle ρ et la variance de chaque observation σ
2, soit

$$
  ψ = \left( {\begin{array}{cc}
    ρ \\
    σ^2 \\
  \end{array} } \right)
$$
*Ecriture matricielle* Du fait de l'indépendance entre les mesures obtenues sur des
animaux différents, la matrice de variance Σ a aussi une même forme diagonale par blocs  mais le bloc R diffère :

$$
  R = \left( {\begin{array}{cc}
     σ^2 & σ^2ρ & σ^2ρ^2 & ... & σ^2ρ^{T-1}\\
     σ^2ρ & ... & ... & ... & ...\\
     σ^2ρ^2 & ... & σ^2 & ... & σ^2ρ^2\\
     ... & ... & ... & ... & σ^2ρ\\
    σ^2ρ^{T-1} & ... & σ^2ρ^2 & σ^2ρ & σ^2\\
  \end{array} } \right)
$$
```{r}
o.ar1 = gls(Strength ~ Program * Timef, data = d,correlation = corAR1(form = ~ 1 | Subj))
 

```



```{r}
data.spatialCor.glsExp <- gls(y ~ x, data = data.spatialCor,
    correlation = corExp(form = ~LAT + LONG, nugget = TRUE),
    method = "REML")
```


>>>>>>> 9b4295d8c214c926030dc2d9e99fe1a5df52456a

$$ E(Y_{ijt}) = µ + α_i + γ_t + (αγ)_{it} $$

## Application : Ael

### Exploration des données

### Création du model

### Validation

### Interpretation

This chapter is a simple example using R

You can import R package using the code

```{r}
library(tidyverse)
```

and then describe the purpose of your chapter as well as executing R command.

For example a basic summary of a dataset is given by

```{r}
df <- read.table("https://gist.githubusercontent.com/slopp/ce3b90b9168f2f921784de84fa445651/raw/4ecf3041f0ed4913e7c230758733948bc561f434/penguins.csv", sep = "," , header = TRUE)
```

and produce a graph

```{r}
df %>% ggplot() +
	aes(x=species, y = body_mass_g) +
	geom_boxplot()  
```

A citation @bauer2023writing
